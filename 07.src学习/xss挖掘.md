注意一下那个国外白帽子的xss文档pdf，总结很好
# 同源策略
同源策略限制了不同源之间如何进行资源交互，是用于隔离潜在恶意文件的重要安全机制。 是否
同源由URL决定，URL由协议、域名、端口和路径组成，如果两个URL的协议、域名和端口相同，
则表示他们同源

http:www.baidu.com:8080与https:www.baidu.com:8080不同源（协议不同）

# 升级危害
cors，csrf，越权

## 场景
在sub.aaa.com发现一个xss，同时这地方可注册可登陆功能很多，这个xss可以如何来升级危害
1. 修改邮箱，然后重置密码（用邮箱登陆，或者重置密码和邮箱有关的情况下）
2. 修改密码
3. 添加一个sso登陆
4. 读取sessiontoken在某个页面
5. 给这个组织添加一个管理员
6. 读取apikey
7. 通过oauth账号接管

**可以升级危害的情况**：
与cors配置有关
第一种就是sub1.aaa.com或者某种比较核心的重要子域名存在cors 配置为任意子域名可以读取它的内容，那么sub2.aaa.com 就能读取这些域名的内容进行进一步升级危  害

第二种：与httponly有关（难搞的）
![[Pasted image 20240904211738.png]]
# 案例
![[Pasted image 20240904230359.png]]
此处单引号双引号都过滤了，在url中尝试%2"2发现%22直接输出在了html上，就是说没解码，所以还是不行
蓝色部分其实是js部分，于是我们考虑用-alert()-来弹窗，这样的话我们就需要用单引号闭合前后的单引号，但是被过滤了，所以考虑用html编码来闭合前后的单引号，单引号的html编码是&#x27，要对特殊符号编码url，所以最终payload是xxxxx%26%23x27;-alert()-%26%23x27;(这里不加；好像也可以)


# 基础的xss上下文
前闭合，后注释（后闭合），中间payload
有的标签是不需要闭合，尽可能先闭合

# 过滤和waf
过滤一般指的是对某些关键词进行删除或者替换，比如检到\<script>将其删掉，检查到alert 将其删掉WAF一般值得是拦截，比如检查到某个关键词或者某种规则给你返回403

一些等价替换
![[Pasted image 20240905105412.png]]

在x和28之间加任意多个0，还是x28，加几个不行就多加一点
![[Pasted image 20240905110302.png]]
# csp
什么情况下可以绕过，什么情况下直接跑路
# 注意
一般来说浏览器会对url的特殊字符进行编码，然后会自动解码，如果我们的攻击只有在浏览器不对url进行编码的情况下才能进行的话，那么这是不行的。 如果一切都没问题，但是还是不弹窗，那么考虑是csp的问题
批量的时候优先处理尖括号不过滤的

tips：大多数人会先挖爬取结果多的，我们反其道而行， 先找到爬取结果少点的，进行更深入收集（目录爆破等）找xss，路径短杆、下划线的也可能出洞