# 应急案例
看告警的时候，收到阿里云的信息通知，说服务器正在对外进行攻击，让我排查具体情况
用netstat命令，发现有一万多个id是28263（不记得了），名称叫bdgopoga的可疑进程，初步判断为口令爆破，
然后排查账号发现有未知ip登陆了ssh的root账号，就是那个进程id，
然后我就去访问那个ip，发现开着80端口，发现是某企业的，怀疑他是肉鸡跳板，。然后我就终止了这个进程，修改密码，排查ssh后面账号和公钥
我用pstree -aps 28263（那个可疑的进程id），获取完整进程树，后续终止了和该id有关id的所有进程
通过启动进程的命令定位到恶意程序及其目录，备份后删除，
后面又再次查看了所有进程，发现隐藏进程id，发现启动进程的命令是rti，经过排查我发现是之前恶意进程的子进程，我就进行了终止，
后续我又进行了进程资源排查，无异常
文件排查，通过恶意程序的ctime确定了攻击者的活动时间，并根据时间排查他执行过的命令
后续又排查了临时目录下的文件，没发现命令有被恶意替换，也没有发现特权文件，
后面我把恶意程序用沙箱进行分析，发现是远控木马，
通过查看lib下的文件，我发现有个文件名字不一样但是内容却和另外一个文件一样，然后我就都进行了备份删除
还有查看被攻击期间修改过的authorized_keys文件，发现了两个后面ssh公钥，进行删除
后门排查，发现有端口在监听，进程id和之前的一样。终止，
还进行了/etc/passwd和/etc/shadow文件的排查，没有发现后门，包括启动项，定时任务都没有
### 溯源
系统日志排查
中间件日志
数据库日志
安全产品日志
溯源结论，记录了开始攻击和结束的时间以及攻击操作和上传的目录程序，因为是跳板攻击，所以没有后续
# 内存马查杀
1.看中间件日志
先判断是通过什么方法注入的内存马，可以通过查看weib日志是否有可疑的web访问日志，如果是filter和listener类型会有大量url请求路径相同的参数
查看响应码为200，但是页面不存在的，看看有没有和哥斯拉，冰蝎相同的url请求
通过查找返回200的url路径对比web目录下是否真实存在文件，不存在则为内存马
2，中间件日志无异常
如果web日志无异常，排查是否为中间件漏洞导致代码执行注入内存马，排查errpr.log日志，看看有没有可疑的报错，根据注入时间和方法根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞反序列化漏洞等。
3，杀马方法
	在已有恶意内存马相同路径下，再注入一个相同名字路径的内存马，相当于把他逼走；
内存马一般重启就没了，也可以重启
河马工具内存马查杀